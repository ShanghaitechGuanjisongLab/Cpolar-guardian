<?xml version="1.0" encoding="UTF-8"?>

<!-- Define the variables in "$(var.*) expressions" -->
<?define Name = "Cpolar守护者" ?>
<?define Manufacturer = "埃博拉酱" ?>
<?define Version = "1.0.0.0" ?>
<?define UpgradeCode = "cc9051b6-9aa6-46f8-94fc-bd4e9bdd586a" ?>

<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
	<Package Name="$(Name)"
			 Manufacturer="$(Manufacturer)"
			 Version="$(Version)"
			 UpgradeCode="$(var.UpgradeCode)"
			 Compressed="true"
			 Scope="perMachine">

		<!-- Allow upgrades and prevent downgrades -->
		<MajorUpgrade DowngradeErrorMessage="已经安装了更高版本的[ProductName]。安装程序现在将退出。" />

		<!-- Define the directory structure -->
		<StandardDirectory Id="ProgramFiles64Folder">

			<!-- Create a folder inside program files -->
			<Directory Id="ROOTDIRECTORY" Name="$(var.Manufacturer)">

				<!-- Create a folder within the parent folder given the name -->
				<Directory Id="INSTALLFOLDER" Name="$(Name)">

					<!-- Create a single component which is the App.WindowsService.exe file -->
					<Component Id="ServiceExecutable" Bitness="always64" Guid="cf8e05cb-fb13-fb8d-699e-581a70ce28b5">

						<!-- Copies the App.WindowsService.exe file using the
					 project reference preprocessor variables -->
						<File Source="$(sys.CURRENTDIR)..\Cpolar守护服务\发布\Cpolar守护服务.exe"
							  KeyPath="yes" />
						<File Id="UserInterface"
							  Source="$(sys.CURRENTDIR)..\Cpolar守护者\发布\Cpolar守护者.exe"
							  KeyPath="no" />						

						<!-- Remove all files from the INSTALLFOLDER on uninstall -->
						<RemoveFile Name="*.*" On="uninstall" />

						<!-- Tell WiX to install the Service -->
						<ServiceInstall Id="ServiceInstaller"
										Type="ownProcess"
										Name="Cpolar守护服务"
										DisplayName="$(Name)"
										Description="Cpolar守护服务"
										Start="disabled"
										ErrorControl="normal"
										Account=".\LocalSystem"/>
					</Component>
				</Directory>
			</Directory>
		</StandardDirectory>
		<StandardDirectory Id="ProgramMenuFolder">
			<Component Id="UIShortcut" Guid="c4a0ffa9-bb9c-4c54-7d46-7b264e65f227">
				<Shortcut Name="Cpolar守护者" Target="[UserInterface]" WorkingDirectory="INSTALLFOLDER"/>
				<RemoveFile Name="Cpolar守护者.lnk" On="uninstall"/>
			</Component>
		</StandardDirectory>
		<!-- Tell WiX to install the files -->
		<Feature Id="Service" Title="Cpolar守护者" Level="1">
			<ComponentRef Id="ServiceExecutable" />
			<ComponentRef Id="UIShortcut"/>
		</Feature>

	</Package>
</Wix>